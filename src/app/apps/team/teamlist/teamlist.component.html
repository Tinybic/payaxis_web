<div class="row">
    <div class="col-md-6 headline">
        Members
    </div>
    <div class="col-md-6 text-end">
        <button class="btn btn-outline-primary" *ngIf="!editFlag" (click) = "startEdit()"><i class="fe-edit me-1-1"></i>Edit</button>
        <button class="btn btn-primary"  *ngIf="editFlag" (click) = "saveEdit()">Save</button>
        <button class="btn btn-primary ms-2-1">New Bill<i class="fe-chevron-down ms-1-1"></i></button>
        <i class="fe-more-vertical- font-24 ms-2-1 cursor-pointer" (click)="inviteMembers()"></i>
    </div>
</div>

<div class="row">
    <div class="col-md-4">
        <div class="dropdown" ngbDropdown #statusDrop="ngbDropdown">
            <a href="javascript:void(0)" class="bold-600 font-20 text-black line-60"
                ngbDropdownToggle>{{statusFilter}}({{allCount}}) <i class=" fe-chevron-down"></i></a>
            <div class="dropdown-menu" ngbDropdownMenu>
                <div class="mb-2">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" name="statusFilter"
                            [checked]="statusFilter=='All'"
                            (change)="changeStatusFilter('All');$event.stopPropagation(); statusDrop.close();">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            All({{allCount}})
                        </label>
                    </div>
                </div>
                <div class="mb-2">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" [checked]="statusFilter=='Active'"
                            (change)="changeStatusFilter('Active');$event.stopPropagation(); statusDrop.close();"
                            name="statusFilter">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            Active({{activeCount}})
                        </label>
                    </div>
                </div>
                <div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" [checked]="statusFilter=='Pending'"
                            (change)="changeStatusFilter('Pending');$event.stopPropagation(); statusDrop.close();"
                            name="statusFilter">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            Pending({{pendingCount}})
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-8 text-end mt-2-1">

        <div class="dropdown" ngbDropdown>
            <a class="dropdow-outline" href="javascript:void(0)" ngbDropdownToggle>
                <i class="fe-user font-16 me-1-1"></i>
                {{roleFilter}}
                <i class="fe-chevron-down font-16 ms-1-1"></i>
            </a>
            <div class="dropdown-menu" ngbDropdownMenu>
                <div class="mb-2">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck" [checked]="roleFilter=='All'"
                        (change)="changeRoleFilter('All');$event.stopPropagation(); statusDrop.close();">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            ALL
                        </label>
                    </div>
                </div>
                <div class="mb-2">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck" [checked]="roleFilter=='View Only'"
                        (change)="changeRoleFilter('View Only');$event.stopPropagation(); statusDrop.close();">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            View Only
                        </label>
                    </div>
                </div>
                <div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck" [checked]="roleFilter=='Create & Edit'"
                        (change)="changeRoleFilter('Create & Edit');$event.stopPropagation(); statusDrop.close();">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            Create & Edit
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <!--end filter 1-->
        <div class="dropdown ms-1-1" ngbDropdown>
            <a class="dropdow-outline" href="javascript:void(0)" ngbDropdownToggle>
                <i class="fe-folder font-16 me-1-1"></i>
                Project
                <i class="fe-chevron-down font-16 ms-1-1"></i>
            </a>
            <div class="dropdown-menu" ngbDropdownMenu>
                <div class="mb-2">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            ALL
                        </label>
                    </div>
                </div>
                <div class="mb-2">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            Approval
                        </label>
                    </div>
                </div>
                <div class="mb-2">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            Admin
                        </label>
                    </div>
                </div>
                <div class="mb-2">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            Editor
                        </label>
                    </div>
                </div>
                <div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            Viewer
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <!--end filter 2-->
        <div class="dropdown ms-1-1" ngbDropdown>
            <a class="dropdow-outline" href="javascript:void(0)" ngbDropdownToggle>
                <i class="fe-dollar-sign font-16 me-1-1"></i>
                {{approvalAmountFilter}}
                <i class="fe-chevron-down font-16 ms-1-1"></i>
            </a>
            <div class="dropdown-menu" ngbDropdownMenu>
                <div class="mb-2">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck"  [checked]="approvalAmountFilter=='All'"
                        (change)="changeapprovalAmountFilter('All');$event.stopPropagation(); statusDrop.close();">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            ALL
                        </label>
                    </div>
                </div>
                <div class="mb-2">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck" [checked]="approvalAmountFilter=='1000'"
                        (change)="changeapprovalAmountFilter('1000');$event.stopPropagation(); statusDrop.close();">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            $1,000
                        </label>
                    </div>
                </div>
                <div class="mb-2">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck" [checked]="approvalAmountFilter=='2000'"
                        (change)="changeapprovalAmountFilter('2000');$event.stopPropagation(); statusDrop.close();">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            $2,000
                        </label>
                    </div>
                </div>
                <div class="mb-2">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck" [checked]="approvalAmountFilter=='5000'"
                        (change)="changeapprovalAmountFilter('5000');$event.stopPropagation(); statusDrop.close();">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            $5,000
                        </label>
                    </div>
                </div>
                <div class="mb-2">
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck" [checked]="approvalAmountFilter=='7500'"
                        (change)="changeapprovalAmountFilter('7500');$event.stopPropagation(); statusDrop.close();">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            $7,500
                        </label>
                    </div>
                </div>
                <div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="dropdownCheck" [checked]="approvalAmountFilter=='10000'"
                        (change)="changeapprovalAmountFilter('10000');$event.stopPropagation(); statusDrop.close();">
                        <label class="form-check-label ms-1-1" for="dropdownCheck">
                            $10,000
                        </label>
                    </div>
                </div>
            </div>
        </div>
        <!--end filter 3-->
        <div class="d-inline-block ms-1-1">
            <input class="form-control form-search" type="text" placeholder="Search here" [(ngModel)]="keywords"
                (keyup.enter)="searchTable()" />
        </div>
        <!-- end search-->
    </div>
</div>
<div class="row mt-3">
    <div class="col-md-12">
        <table class="advanced-table">
            <thead>
                <tr>
                    <th class="row_select"><input class="form-check" type="checkbox" /></th>
                    <th class="sortable"
                        [ngClass]="{'sorting_asc':sortCloumn == 'firstName' && direction == 'asc','sorting_desc':sortCloumn == 'firstName' && direction == 'desc'}"
                        (click)="onSort('firstName')">User</th>
                    <th class="sortable"
                        [ngClass]="{'sorting_asc':sortCloumn == 'role' && direction == 'asc','sorting_desc':sortCloumn == 'role' && direction == 'desc'}"
                        (click)="onSort('role')">Role</th>
                    <th class="sortable"
                        [ngClass]="{'sorting_asc':sortCloumn == 'approvalAmount' && direction == 'asc','sorting_desc':sortCloumn == 'approvalAmount' && direction == 'desc'}"
                        (click)="onSort('approvalAmount')">Approval amount</th>
                    <th class="sortable"
                        [ngClass]="{'sorting_asc':sortCloumn == 'active' && direction == 'asc','sorting_desc':sortCloumn == 'active' && direction == 'desc'}"
                        (click)="onSort('active')">Status</th>
                    <th>&nbsp;</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let item of members; let i = index">
                    <td><input class="form-check" type="checkbox" /></td>
                    <td>
                        <div class="d-flex flex-row">
                            <div class="me-1-1">
                                <app-avatar [bgColor]="bgColors[i % 6]" [url]="item.avatar" [firstName]="item.firstName"
                                    [lastName]="item.lastName" [size]="32" alt="user-img"></app-avatar>
                            </div>
                            <div>
                                <div class="bold-600">{{item.firstName}}&nbsp;{{item.lastName}}</div>
                                <div class="text-typeblackdeactivated">ManagerSales</div>
                            </div>
                        </div>
                    </td>
                    <td>
                        <app-dropdowndata  *ngIf="editFlag && item.role != 'Owner'" [displayText]="item.role" [data] = "roleItems" (selectValue) = "editRoleValue(item,$event)"></app-dropdowndata>
                        <span *ngIf="!editFlag || item.role == 'Owner'">{{item.role}}</span>
                    </td>
                    <td>
                        <app-dropdowndata  *ngIf="editFlag && item.role != 'Owner'" [displayText]="'$'+ item.approvalAmount" [data] = "approvalAmount" (selectValue) = "editApprovalAmount(item,$event)"></app-dropdowndata>
                        <span *ngIf="!editFlag || item.role == 'Owner'">${{item.approvalAmount}}</span>
                    </td>
                    <td>{{item.active?'Active':'InActive'}}</td>
                    <td><i class=" fe-trash-2 cursor-pointer" *ngIf="idUser==idUserOwner && item.role != 'Owner'"
                            (click)="deactive(item.id,item.firstName,item.lastName)"></i></td>
                </tr>
            </tbody>
            <tfoot style="height: 16px;">
                <tr>
                    <td colspan="5">&nbsp;</td>
                </tr>
            </tfoot>
        </table>
    </div>
</div>


<ng-template #inviteMember let-modal>
    <div class="modal-body">
        <div class="headline mt-1-1 mb-1-1">Invite Members to [{{companyName}}]</div>

        <div *ngIf="step =='step1'" class="formContainer">
            <div>
                <input class="form-control" [(ngModel)]="email" type="email" multiple
                    placeholder="Email, separate with comma" />
            </div>

            <div class="bottomButton">
                <div>
                    <button class="btn btn-primary" [disabled]="email.length == 0" (click)="step1()">Next</button>
                </div>
                <div>
                    <button class="btn btn-outline-primary mt-1-1"
                        (click)="modal.dismiss('Cross click')">Cancel</button>
                </div>
            </div>
        </div>

        <!--end step 1-->
        <div *ngIf="step =='step2'" class="formContainer">
            <div class="emaillistInfo">
                <div class="emailItem mt-1-1 ms-1-1 d-inline-block" *ngFor="let item of emailList; let i = index">
                    {{item}}<i class="fe-x ms-1-1 bg-white cursor-pointer rounded-circle" (click)="deleteEmail(i)"></i>
                </div>
            </div>

            <div class="bottomButton">
                <div>
                    <button class="btn btn-primary" [disabled]="emailList.length == 0" (click)="step2()">Next</button>
                </div>
                <div>
                    <button class="btn btn-outline-primary mt-1-1"
                        (click)="step = 'step1' ;modal.dismiss('Cross click')">Cancel</button>
                </div>
            </div>
        </div>
        <!--end step 2-->

        <div *ngIf="step =='step3'" class="formContainer">
            <div class="row mt-1-1" *ngFor="let item of userList; let i = index">
                <div class="col-md-1">
                    <div [ngClass]="bgColors[0]" class=" rounded-circle"
                        style="width:32px; height: 32px; padding: 8px;">
                        <i class="fe-user text-white  font-16"></i>
                    </div>
                </div>
                <div class="col-md-4 line-32 overflow-hidden">{{item.email}}</div>
                <div class="col-md-4 text-end">
                    <div class="dropdown" ngbDropdown #myDrop="ngbDropdown">
                        <div style="background-color: #F1F3F9; border-radius: 8px; padding: 0px 8px"
                            class="bold-600 text-primary font-12 line-32 cursor-pointer dropdown-toggle"
                            ngbDropdownToggle>{{item.approvalAmountText}}<i class="fe-chevron-down ms-1-1 font-16"></i>
                        </div>
                        <div class="dropdown-menu" ngbDropdownMenu>
                            <div class="mb-2">
                                <label class="form-check-label ms-1-1 cursor-pointer"
                                    (click)="step3Approval(item,'1000','$1,000');$event.stopPropagation(); myDrop.close();">
                                    $1,000
                                </label>
                            </div>
                            <div class="mb-2">
                                <label class="form-check-label ms-1-1 cursor-pointer"
                                    (click)="step3Approval(item,'2000','$2,000');$event.stopPropagation(); myDrop.close();">
                                    $2,000
                                </label>
                            </div>
                            <div class="mb-2">
                                <label class="form-check-label ms-1-1 cursor-pointer"
                                    (click)="step3Approval(item,'5000','$5,000');$event.stopPropagation(); myDrop.close();">
                                    $5,000
                                </label>
                            </div>
                            <div class="mb-2">
                                <label class="form-check-label ms-1-1 cursor-pointer"
                                    (click)="step3Approval(item,'7500','$7,500');$event.stopPropagation(); myDrop.close();">
                                    $7,500
                                </label>
                            </div>
                            <div>
                                <label class="form-check-label ms-1-1 cursor-pointer"
                                    (click)="step3Approval(item,'10000','$10,000 +');$event.stopPropagation(); myDrop.close();">
                                    $10,000 +
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 text-end">
                    <div class="dropdown" ngbDropdown #roleDrop="ngbDropdown">
                        <div class="bold-600 line-32 cursor-pointer" ngbDropdownToggle>{{item.role}}<i
                                class="fe-chevron-down ms-1-1 font-16"></i></div>
                        <div class="dropdown-menu" ngbDropdownMenu>
                            <div class="mb-2">
                                <label class="form-check-label ms-1-1 cursor-pointer"
                                    (click)="step3Role(item,'2','View Only'); roleDrop.close();">
                                    View Only
                                </label>
                            </div>
                            <div class="mb-2">
                                <label class="form-check-label ms-1-1 cursor-pointer"
                                    (click)="step3Role(item,'3','Create & Edit'); roleDrop.close();">
                                    Create & Edit
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="bottomButton">
                <div>
                    <button class="btn btn-primary" (click)="send()">Send Invite</button>
                </div>
                <div>
                    <button class="btn btn-outline-primary mt-1-1"
                        (click)="step = 'step1' ;modal.dismiss('Cross click')">Cancel</button>
                </div>
            </div>
        </div>

        <!--end step 3-->
    </div>
</ng-template>

<swal #ajaxRequest [swalOptions]="alertOption"></swal>